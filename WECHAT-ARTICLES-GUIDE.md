# 微信文章管理功能使用说明

## 功能概述

在后台管理页面（/admin）新增了「微信文章」标签页，可以管理从公众号抓取的所有文章。

## 主要功能

### 1. 文章列表查看
- 显示所有微信文章的标题、描述、封面图、发布日期、分类等信息
- 支持按分类筛选（Jinqiu Select、Jinqiu Scan 等）
- 支持搜索文章（标题和内容关键词）

### 2. 文章编辑
- 点击「编辑」按钮打开编辑弹窗
- 可修改：
  - 文章标题
  - 文章描述
  - 封面图片 URL
  - 文章分类
  - 文章内容（富文本编辑）

### 3. 文章内容编辑（富文本）
- 支持格式化文本（加粗、斜体、下划线）
- 支持列表（无序/有序）
- 支持插入链接
- **支持插入图片** 🖼️

### 4. 插入图片功能

#### 方法一：使用工具栏按钮
1. 将光标放在要插入图片的位置
2. 点击工具栏的「🖼️ 插入图片」按钮
3. 选择本地图片文件
4. 图片将以 base64 格式插入到文章中

#### 方法二：设置封面图
1. 在编辑弹窗的「封面图片 URL」输入框中
2. 输入图片的 URL 地址
3. 该图片将作为文章封面显示在列表中

#### 方法三：在内容中手动插入 HTML
在富文本编辑器中切换到源码模式（通过浏览器开发者工具），手动插入：
```html
<img src="图片URL" alt="描述" style="max-width: 100%;" />
```

## 图片上传注意事项

### 当前实现
- **临时方案**：使用 base64 编码存储图片
- **优点**：简单易用，无需配置存储服务
- **缺点**：base64 会使图片体积增大约 33%，不适合大图片

### 推荐做法
1. **图片尺寸**：建议使用 800-1200px 宽度的图片
2. **图片格式**：优先使用 JPEG（照片）或 PNG（图标）
3. **图片大小**：单个图片建议不超过 500KB
4. **优化建议**：使用 TinyPNG 等工具压缩图片

### 未来优化方向
- 集成 Supabase Storage 或 Cloudinary 等图片存储服务
- 支持拖拽上传图片
- 添加图片裁剪和编辑功能

## 使用步骤

### 1. 访问后台
```
http://localhost:3000/admin
```

### 2. 登录
输入管理员密码

### 3. 切换到「微信文章」标签
点击顶部标签栏的「微信文章」按钮

### 4. 编辑文章
1. 找到要编辑的文章
2. 点击「✏️ 编辑」按钮
3. 在弹窗中修改内容
4. 点击「保存更改」

### 5. 查看效果
刷新前端页面，查看修改后的文章

## API 接口

### 获取文章列表
```
GET /api/admin/wechat-articles?password=xxx&category=xxx&limit=20&offset=0
```

### 更新文章
```
PUT /api/admin/wechat-articles
Content-Type: application/json

{
  "password": "xxx",
  "id": "article_id",
  "title": "文章标题",
  "description": "文章描述",
  "content": "<p>文章内容</p>",
  "coverImage": "图片URL",
  "category": "jinqiu-select"
}
```

### 删除文章
```
DELETE /api/admin/wechat-articles
Content-Type: application/json

{
  "password": "xxx",
  "id": "article_id"
}
```

## 数据存储

所有文章数据存储在 Supabase 数据库的 `wechat_articles` 表中：

| 字段 | 类型 | 说明 |
|------|------|------|
| id | text | 文章 ID（主键） |
| title | text | 文章标题 |
| description | text | 文章描述 |
| content | text | 文章内容（HTML） |
| url | text | 原文链接 |
| cover_image | text | 封面图片 URL |
| publish_time | bigint | 发布时间戳 |
| publish_date | text | 发布日期（格式化后） |
| mp_name | text | 公众号名称 |
| category | text | 文章分类 |
| updated_at | timestamp | 更新时间 |

## 常见问题

### Q: 编辑后前端没有更新？
A: 前端可能有缓存，可以：
1. 强制刷新浏览器（Ctrl+Shift+R 或 Cmd+Shift+R）
2. 检查 Supabase 数据库中数据是否已更新

### Q: 图片上传失败？
A: 检查以下几点：
1. 图片文件大小是否过大（建议 < 500KB）
2. 浏览器是否支持 FileReader API
3. 查看浏览器控制台的错误信息

### Q: base64 图片导致文章加载慢？
A: 这是 base64 编码的副作用。建议：
1. 使用较小的图片
2. 压缩图片后再上传
3. 考虑使用外部图片 URL

### Q: 如何批量插入图片？
A: 目前不支持批量插入，需要：
1. 逐个点击「🖼️ 插入图片」按钮
2. 或在富文本编辑器中粘贴图片（部分浏览器支持）

## 技术支持

如遇到问题，请：
1. 检查浏览器控制台的错误信息
2. 查看 API 响应是否正常
3. 确认 Supabase 数据库连接正常

---

**更新时间**：2025-01-06
**版本**：v1.0.0
